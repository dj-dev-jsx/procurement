import{v as q,q as B,r as P,j as e,$ as S,m as A}from"./app-93n4-YE1.js";import{R as k}from"./RequesterLayout-Cbv_OArf.js";import{S as d}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{F as D}from"./PencilSquareIcon-BtsTF4Sc.js";import{c as b}from"./index-DEGu_kMU.js";import{C as R}from"./circle-check-big-CDYAS76j.js";import"./Dropdown--SqrWfdR.js";import"./transition-B8_0YiEE.js";import"./toaster-CR_CLjT4.js";import"./index-BYPC565r.js";import"./index-C6Troi14.js";import"./XMarkIcon-BajPl_Ya.js";import"./BellAlertIcon-DQ7YZFl9.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],p=b("circle-plus",F);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],I=b("trash",E);function K({prId:y,products:h,pr_number:l,prDetails:o}){const{data:r,setData:c,post:f,put:j,processing:u,errors:a,reset:N}=q({id:null,pr_number:l,product_id:"",item:"",specs:"",unit:"",unit_price:"",quantity:""}),g=t=>{var x;if(o.some(m=>m.product_id==t)){d.fire({icon:"error",title:"Product already added",text:"This product has already been added to the purchase request.",confirmButtonColor:"#d33"});return}if(!t){c({...r,product_id:"",item:"",specs:"",unit:"",unit_price:""});return}const s=h.find(m=>m.id==t);s&&c({...r,product_id:s.id,item:s.name,specs:s.specs,unit:((x=s.unit)==null?void 0:x.unit)||"",unit_price:s.default_price||""})},n=B().props;P.useEffect(()=>{var t,i;(t=n.flash)!=null&&t.success&&d.fire({icon:"success",title:"Success",text:n.flash.success,confirmButtonColor:"#2563EB"}),(i=n.flash)!=null&&i.error&&d.fire({icon:"error",title:"Error",text:n.flash.error,confirmButtonColor:"#d33"})},[n.flash]);const w=()=>{console.log(r.quantity),r.quantity&&d.fire({title:r.id?"Update Item?":"Add Item?",text:r.id?"This will update the selected item in your PR.":"Do you want to add this item to the PR?",icon:"question",showCancelButton:!0,confirmButtonColor:"#2563EB",cancelButtonColor:"#d33",confirmButtonText:"Confirm"}).then(t=>{if(t.isConfirmed){const i=r.id?route("requester.update_details",r.id):route("requester.store_details",y);(r.id?j:f)(i,{preserveScroll:!0,onSuccess:()=>N()})}})},v=t=>{t.preventDefault(),d.fire({title:"Finish PR?",text:"Once you finish, you will go back to the request list.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#2563EB",cancelButtonColor:"#d33",confirmButtonText:"Confirm"}).then(i=>{i.isConfirmed&&(window.location.href=route("requester.manage_requests"))})};function C(t){c({id:t.id,product_id:t.product_id,item:t.item,specs:t.specs,unit:t.unit,unit_price:t.unit_price,quantity:t.quantity,pr_number:l})}const _=t=>{d.fire({title:"Are you sure?",text:`Delete item "${t.item}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#aaa",confirmButtonText:"Confirm"}).then(i=>{i.isConfirmed&&A.delete(route("requester.delete_details",t.id),{preserveScroll:!0,onSuccess:()=>{d.fire("Deleted!","Item has been removed.","success")},onError:s=>{console.error("Delete failed:",s),d.fire("Error!","Failed to delete item.","error")}})})};return e.jsxs(k,{header:"Schools Division Office - Ilagan | Add Details",children:[e.jsx(S,{title:"PR Details"}),e.jsxs("div",{className:"mx-auto mt-10 bg-white p-10 shadow-2xl",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-8 text-left text-gray-800",children:["Purchase Request Details — ",e.jsx("span",{className:"text-blue-600",children:l})]}),e.jsxs("div",{className:"max-w-5xl mx-auto mb-5 bg-white shadow-md border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-500",style:{width:"100%"}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 font-semibold px-1",children:[e.jsx("span",{className:"text-gray-500",children:"Step 1: Create PR"}),e.jsx("span",{className:"text-blue-600",children:"Step 2: Add Items"})]})]}),e.jsx("div",{className:"overflow-x-auto mb-10",children:e.jsxs("table",{className:"w-full min-w-[700px] border border-gray-300 shadow rounded-lg text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b",children:"Item"}),e.jsx("th",{className:"px-4 py-3 border-b",children:"Specs"}),e.jsx("th",{className:"px-4 py-3 border-b",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Default Unit Price (₱)"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Total (₱)"}),e.jsx("th",{className:"px-4 py-3 border-b text-center",children:"Actions"})]})}),e.jsx("tbody",{children:o.length>0?o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 border-b",children:t.item}),e.jsx("td",{className:"px-4 py-3 border-b",children:t.specs}),e.jsx("td",{className:"px-4 py-3 border-b",children:t.unit}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:Number(t.unit_price).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:(Number(t.unit_price)*t.quantity).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs("button",{onClick:()=>C(t),className:"inline-flex items-center px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsxs("button",{onClick:()=>_(t),className:"inline-flex items-center px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Delete"]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-6 text-gray-500",children:"No items added yet."})})})]})}),e.jsxs("h3",{className:"text-2xl font-semibold mb-6 text-center text-gray-700",children:["Add Item to PR ",e.jsx("span",{className:"text-blue-600",children:l})]}),e.jsxs("form",{onSubmit:t=>t.preventDefault(),className:"mx-auto space-y-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-800",children:"Select a Product"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border border-gray-300 rounded-lg shadow",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Item"}),e.jsx("th",{className:"px-3 py-2 border",children:"Specifications"}),e.jsx("th",{className:"px-3 py-2 border",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 border",children:"Default Price (₱)"}),e.jsx("th",{className:"px-3 py-2 border text-center",children:"Select"})]})}),e.jsx("tbody",{children:h.map(t=>{var s;const i=o.some(x=>x.product_id===t.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 border",children:t.name}),e.jsx("td",{className:"px-3 py-2 border",children:t.specs}),e.jsx("td",{className:"px-3 py-2 border",children:((s=t.unit)==null?void 0:s.unit)||"-"}),e.jsx("td",{className:"px-3 py-2 border",children:Number(t.default_price).toFixed(2)}),e.jsx("td",{className:"px-3 py-2 border text-center",children:i?e.jsx("span",{className:"text-green-600 font-semibold text-xs",children:"Added"}):e.jsx("button",{type:"button",onClick:()=>g(t.id),className:"bg-blue-500 hover:bg-blue-600 text-white w-8 h-8 rounded-full text-lg font-bold transition",title:"Add Product",children:"+"})})]},t.id)})})]})}),a.product_id&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:a.product_id})]}),e.jsxs("div",{children:[r.id&&e.jsxs("p",{className:"text-sm text-yellow-600 font-medium mb-4",children:["You are editing item ",e.jsx("strong",{children:r.item}),'. Click "Add to PR" to update.']}),e.jsx("h4",{className:"text-lg font-semibold mb-2 text-gray-800",children:"Selected Product Details"}),e.jsxs("table",{className:"w-full border border-gray-200 rounded-lg shadow text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-b",children:"Item"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Specs"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Unit"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Unit Price (₱)"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Quantity"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"text-gray-800",children:[e.jsx("td",{className:"px-4 py-2 border-b",children:r.item||"-"}),e.jsx("td",{className:"px-4 py-2 border-b",children:r.specs||"-"}),e.jsx("td",{className:"px-4 py-2 border-b",children:r.unit||"-"}),e.jsx("td",{className:"px-4 py-2 border-b",children:r.unit_price?Number(r.unit_price).toFixed(2):"-"}),e.jsxs("td",{className:"px-4 py-2 border-b",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.quantity,onChange:t=>c("quantity",t.target.value),className:`w-24 border rounded px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.quantity?"border-red-500":"border-gray-300"}`}),a.quantity&&e.jsx("p",{className:"text-red-500 mt-1 text-sm",children:a.quantity})]})]})})]})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[e.jsx("button",{type:"button",disabled:u,onClick:w,className:"flex items-center gap-2 disabled:opacity-60 text-blue-600 hover:bg-blue-700 hover:text-white font-semibold px-10 py-3 rounded-xl border border-blue-600 transition",children:u?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-5 h-5 animate-spin"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-5 h-5"}),"Add to PR"]})}),e.jsxs("button",{type:"button",onClick:v,className:"flex items-center gap-2 text-gray-600 hover:bg-gray-600 hover:text-white font-semibold px-10 py-3 rounded-xl border border-gray-700 transition",children:[e.jsx(R,{className:"w-5 h-5"}),"Finish"]})]})]})]})]})}export{K as default};
