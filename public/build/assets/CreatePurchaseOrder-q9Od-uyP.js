import{r as a,v as M,j as e,$ as A}from"./app-93n4-YE1.js";import{S as B}from"./SupplyOfficerLayout-CIJBK7rX.js";import{D as C,a as v,b as D,c as P,d as O,e as q}from"./dialog-dmNlH9AS.js";import{B as l}from"./button-b6E2TuAP.js";import{T as V}from"./triangle-alert-CEZsBwGS.js";import"./toaster-CR_CLjT4.js";import"./index-BYPC565r.js";import"./index-DEGu_kMU.js";import"./index-C6Troi14.js";import"./Dropdown--SqrWfdR.js";import"./transition-B8_0YiEE.js";import"./XMarkIcon-BajPl_Ya.js";import"./clipboard-check-BUpBKaMS.js";import"./index-CKryKcUP.js";function ne({pr:u,rfq:F,suppliers:j,winners:x,supplierQuotedPrices:H}){const N=a.useMemo(()=>[...new Set(x.map(t=>t.supplier_id))],[x]),h=a.useMemo(()=>j.filter(t=>N.includes(t.id)),[j,N]),[I,c]=a.useState(!1),[S,b]=a.useState(null),[g,f]=a.useState(""),[R,d]=a.useState(!1),w=t=>x.filter(s=>s.supplier_id===t).map(s=>({pr_detail_id:s.pr_detail_id,item:s.item,specs:s.specs,unit:s.unit,quantity:s.quantity,unit_price:parseFloat(s.quoted_price||0),total_price:parseFloat(s.quoted_price||0)*parseFloat(s.quantity||0),priceSource:"Quoted Price"})),{data:n,setData:y,post:Q,processing:m}=M({rfq_id:F.id,items:[]});a.useEffect(()=>{const t=h.flatMap(s=>w(s.id).map(i=>({...i,supplier_id:s.id})));y("items",t)},[h]);const T=(t,s,i)=>{var p;{const _=Number(i)>=0?Number(i):0,E=(p=u.details.find(L=>L.id===n.items[t].pr_detail_id))==null?void 0:p.quantity;if(_!==E){b({index:t,field:s,value:_}),c(!0);return}}const r=[...n.items],o=Number(i)>=0?Number(i):0;r[t][s]=o,r[t].total_price=Number(r[t].quantity)*Number(r[t].unit_price),y("items",r)},$=()=>{if(!S)return;const{index:t,field:s,value:i}=S,r=[...n.items];r[t][s]=i,r[t].total_price=Number(r[t].quantity)*Number(r[t].unit_price),r[t].change_reason=g,y("items",r),b(null),f(""),c(!1)},U=t=>{t.preventDefault(),d(!0)},k=()=>{Q(route("supply_officer.store_po"),{onFinish:()=>d(!1)})};return e.jsxs(B,{header:"Schools Divisions Office - Ilagan | Create Purchase Order",children:[e.jsx(A,{title:`Create PO for PR #${u.pr_number}`}),e.jsxs("form",{onSubmit:U,className:"bg-white p-6 rounded shadow mx-auto max-w-6xl",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["Create PO for PR #",u.pr_number]}),h.map(t=>{const s=n.items.filter(r=>r.supplier_id===t.id),i=s.reduce((r,o)=>r+Number(o.total_price),0);return e.jsxs("div",{className:"mb-8 border rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-3 font-semibold text-lg",children:["Supplier: ",t.company_name]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border-separate border-spacing-0 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-y border-l px-4 py-2 text-left",children:"Item"}),e.jsx("th",{className:"border-y px-4 py-2 text-left",children:"Specs"}),e.jsx("th",{className:"border-y px-4 py-2 text-center",children:"Unit"}),e.jsx("th",{className:"border-y px-4 py-2 text-right text-blue-600",children:"Quantity"}),e.jsx("th",{className:"border-y px-4 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"border-y border-r px-4 py-2 text-right",children:"Total"})]})}),e.jsxs("tbody",{children:[s.map((r,o)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-b border-l px-4 py-2",children:r.item}),e.jsx("td",{className:"border-b px-4 py-2 text-gray-600",children:r.specs}),e.jsx("td",{className:"border-b px-4 py-2 text-center",children:r.unit}),e.jsx("td",{className:"border-b px-4 py-2 text-right",children:e.jsx("input",{type:"number",min:"0",value:r.quantity,onChange:p=>T(o,"quantity",p.target.value),className:"w-20 border rounded px-2 py-1 text-right bg-yellow-50"})}),e.jsxs("td",{className:"border-b px-4 py-2 text-right",children:["₱",Number(r.unit_price).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),e.jsx("div",{className:`text-xs ${r.priceSource==="Quoted Price"?"text-green-600":"text-gray-500"}`,children:r.priceSource})]}),e.jsxs("td",{className:"border-b border-r px-4 py-2 text-right font-medium",children:["₱",Number(r.total_price).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},`${t.id}-${r.pr_detail_id}`)),e.jsxs("tr",{className:"bg-gray-100 font-semibold",children:[e.jsx("td",{colSpan:"5",className:"border-t px-4 py-2 text-right",children:"Supplier Total:"}),e.jsxs("td",{className:"border-t border-r px-4 py-2 text-right",children:["₱",i.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})]},t.id)}),e.jsx(l,{type:"submit",disabled:m||n.items.length===0,className:"mt-6",children:m?"Submitting...":"Submit Purchase Order"})]}),e.jsx(C,{open:R,onOpenChange:d,children:e.jsxs(v,{children:[e.jsxs(D,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-yellow-500"}),"Confirm Submission"]}),e.jsx(O,{className:"pt-4 text-base",children:"Are you sure you want to create this Purchase Order? Please review the items and quantities before proceeding."})]}),e.jsxs(q,{children:[e.jsx(l,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(l,{onClick:k,disabled:m,className:"bg-green-600 hover:bg-green-700",children:m?"Submitting...":"Confirm & Create PO"})]})]})}),e.jsx(C,{open:I,onOpenChange:c,children:e.jsxs(v,{children:[e.jsxs(D,{children:[e.jsx(P,{children:"Reason for Quantity Change"}),e.jsx(O,{className:"pt-2",children:"You changed the quantity from the original PR. Please provide a reason for this adjustment."})]}),e.jsx("textarea",{value:g,onChange:t=>f(t.target.value),className:"w-full border rounded px-3 py-2 mt-3",rows:"3",placeholder:"Enter reason..."}),e.jsxs(q,{children:[e.jsx(l,{variant:"outline",onClick:()=>{c(!1),b(null),f("")},children:"Cancel"}),e.jsx(l,{onClick:$,disabled:!g.trim(),className:"bg-blue-600 hover:bg-blue-700",children:"Save Change"})]})]})})]})}export{ne as default};
