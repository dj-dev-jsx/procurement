import{r as a,q as B,j as e,Y as k,a as f}from"./app-93n4-YE1.js";import{N as y,D as h}from"./Dropdown--SqrWfdR.js";import{l as C,F as H,T}from"./toaster-CR_CLjT4.js";import{F as S,a as V}from"./XMarkIcon-BajPl_Ya.js";import{F as U}from"./BellAlertIcon-DQ7YZFl9.js";function Y({title:i,titleId:l,...c},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":l},c),i?a.createElement("title",{id:l},i):null,a.createElement("path",{fillRule:"evenodd",d:"M11.986 3H12a2 2 0 0 1 2 2v6a2 2 0 0 1-1.5 1.937V7A2.5 2.5 0 0 0 10 4.5H4.063A2 2 0 0 1 6 3h.014A2.25 2.25 0 0 1 8.25 1h1.5a2.25 2.25 0 0 1 2.236 2ZM10.5 4v-.75a.75.75 0 0 0-.75-.75h-1.5a.75.75 0 0 0-.75.75V4h3Z",clipRule:"evenodd"}),a.createElement("path",{fillRule:"evenodd",d:"M3 6a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H3Zm1.75 2.5a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5h-3.5ZM4 11.75a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 0 1.5h-3.5a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"}))}const W=a.forwardRef(Y);function G({title:i,titleId:l,...c},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":l},c),i?a.createElement("title",{id:l},i):null,a.createElement("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm.75-10.25v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5a.75.75 0 0 1 1.5 0Z",clipRule:"evenodd"}))}const J=a.forwardRef(G);function re({header:i,children:l}){const{user:c}=B().props.auth,[m,L]=a.useState(new Date),[g,F]=a.useState(!1),[M,b]=a.useState(!1),[d,p]=a.useState([]),[E,q]=a.useState(""),[D,N]=a.useState(!1),[K,Q]=a.useState(0),[v,I]=a.useState(!1),[z,u]=a.useState(!1),[P,$]=a.useState(""),w=a.useRef(null),R=d.filter(t=>!t.read).length;a.useEffect(()=>{const t=setInterval(()=>L(new Date),1e3);return()=>clearInterval(t)},[]),a.useEffect(()=>{const t=async()=>{var x;try{const o=(await f.get("/notifications",{timeout:1e4})).data.map(r=>({...r,read:r.read_at!==null})),O=o.filter(r=>!r.read).length,Z=d.filter(r=>!r.read).length;if(v&&O>Z){const r=o.find(j=>!j.read);if(r){const j=((x=r.data)==null?void 0:x.message)||r.message||"ðŸ“¬ You have a new purchase request update!";_(j)}}p(o),v||I(!0)}catch(n){f.isCancel(n)?console.log("Request canceled:",n.message):console.error("Error fetching notifications:",n)}};t();const s=setInterval(t,1e4);return()=>clearInterval(s)},[v]),a.useEffect(()=>{function t(s){w.current&&!w.current.contains(s.target)&&b(!1)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const _=t=>{q(t),N(!0),setTimeout(()=>N(!1),1e4)};m.toLocaleString("en-PH",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0});const A=async(t,s)=>{var x;try{await f.post(`/notifications/${t}/read`),p(n=>n.map(o=>o.id===t?{...o,read:!0}:o)),(x=s.data)!=null&&x.reason?($(s.data.reason),u(!0)):Inertia.visit(route("bac_approver.for_review"))}catch(n){console.error("Failed to mark notification as read:",n)}};return e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[9999] bg-indigo-600 text-white px-6 py-4 rounded-lg shadow-lg text-center text-lg animate-fade-in-out",children:E}),e.jsxs("div",{className:"min-h-screen flex flex-col md:flex-row bg-gray-100",children:[e.jsxs("div",{className:"md:hidden bg-gray-900 text-white flex items-center justify-between px-4 py-3 shadow-md",children:[e.jsx(k,{href:"/",children:e.jsx("img",{src:C,alt:"Logo",className:"h-10 w-auto"})}),e.jsx("button",{onClick:()=>F(!g),className:"focus:outline-none",children:g?e.jsx(S,{className:"h-6 w-6"}):e.jsx(V,{className:"h-6 w-6"})})]}),e.jsx("aside",{className:`${g?"block":"hidden"} md:block md:w-64 w-full bg-gray-900 text-white md:sticky md:top-0 h-screen sticky z-50`,children:e.jsxs("div",{className:"p-6 flex flex-col h-full",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(k,{href:"/",children:e.jsx("img",{src:C,alt:"Department Logo",className:"h-20 w-[200px] object-contain",draggable:"false"})})}),e.jsx("div",{className:"text-center text-xs text-gray-400 font-mono mb-6 select-none",children:"Supply and Property Office"}),e.jsxs("nav",{className:"flex flex-col gap-2",children:[e.jsxs(y,{href:route("requester.dashboard"),active:route().current("requester.dashboard"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(H,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Dashboard"})]}),e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs(y,{href:route("requester.create"),active:route().current("requester.create"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(J,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Create PR"})]}),e.jsxs(y,{href:route("requester.manage_requests"),active:route().current("requester.manage_requests"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(W,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Manage Requests"})]})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("header",{className:"bg-white shadow sticky top-0 z-30 px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:i||"Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"e-Procurement & Inventory Management System"})]}),e.jsxs("div",{className:"relative flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>b(t=>!t),className:"relative focus:outline-none",children:[e.jsx(U,{className:"w-6 h-6 text-gray-600 hover:text-gray-800"}),R>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full px-1.5 py-0.5",children:R})]}),M&&e.jsxs("div",{ref:w,className:"absolute right-0 top-8 w-96 bg-white border border-gray-200 rounded-xl shadow-xl z-50 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-gray-50 text-sm font-semibold text-gray-700",children:"Notifications"}),d.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-center text-gray-500",children:"You're all caught up!"}):e.jsx("ul",{className:"max-h-[420px] overflow-y-auto divide-y divide-gray-100",children:d.sort((t,s)=>new Date(s.created_at)-new Date(t.created_at)).slice(0,10).map(t=>{var s;return e.jsxs("li",{onClick:()=>A(t.id,t),className:`flex items-start gap-3 px-4 py-3 cursor-pointer hover:bg-gray-50 transition duration-150 ${t.read?"bg-white text-gray-500":"bg-gray-50 text-gray-900 font-semibold"}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:t.read?e.jsx("svg",{className:"w-5 h-5 text-gray-300",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 17h5l-1.405-1.405M19.595 15.595A2.1 2.1 0 0120 14.5V11a8.001 8.001 0 00-6.536-7.874m0 0A8 8 0 0119 11v3.5c0 .397.158.779.439 1.06M12.5 21a3.5 3.5 0 01-3.5-3.5"})}):e.jsx("svg",{className:"w-5 h-5 text-indigo-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586L2.707 14.879a1 1 0 001.414 1.414L6 14.414V16a2 2 0 002 2h4a2 2 0 002-2v-1.586l1.879 1.879a1 1 0 001.414-1.414L16 11.586V8a6 6 0 00-6-6z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm leading-tight",children:((s=t.data)==null?void 0:s.message)||t.message||"You have a new notification."}),e.jsxs("div",{className:"flex justify-between mt-1 text-xs",children:[e.jsx("span",{className:"text-gray-400",children:new Date(t.created_at).toLocaleString("en-PH",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),t.read?e.jsx("span",{className:"text-gray-400",children:"Read"}):e.jsx("span",{className:"text-blue-500 font-medium",children:"Unread"})]})]})]},t.id)})}),d.some(t=>!t.read)&&e.jsx("button",{onClick:async()=>{try{await Promise.all(d.map(t=>t.read?null:f.post(`/notifications/${t.id}/read`))),p(t=>t.map(s=>({...s,read:!0})))}catch(t){console.error("Failed to mark all as read:",t)}},className:"w-full text-center py-3 text-sm text-indigo-600 hover:bg-gray-100 border-t",children:"Mark all as read"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(h,{children:[e.jsx(h.Trigger,{children:e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 cursor-pointer",children:[c.firstname," ",c.lastname,e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),e.jsxs(h.Content,{children:[e.jsx(h.Link,{href:route("profile.edit"),children:"Profile"}),e.jsx(h.Link,{href:route("logout"),method:"post",as:"button",children:"Log Out"})]})]})})]})]}),e.jsx("main",{className:"p-6 flex-1 overflow-y-auto bg-gray-300",children:l}),e.jsx(T,{})]})]}),z&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-[10000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity animate-fadeIn",onClick:()=>u(!1)}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-md p-6 animate-scaleIn",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Reason for Send Back"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"text-gray-700 whitespace-pre-line bg-gray-50 p-4 rounded-lg border border-gray-200",children:P}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>u(!1),className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow-md transition",children:"Close"})})]})]})]})}export{re as R};
