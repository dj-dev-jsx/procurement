import{v as B,r as f,j as e,$ as V,m as Q}from"./app-93n4-YE1.js";import{S as G,B as q}from"./SupplyOfficerLayout-CIJBK7rX.js";import{D as M,a as I,b as D,c as z,d as C,e as F}from"./dialog-dmNlH9AS.js";import{B as h}from"./button-b6E2TuAP.js";import{I as b}from"./input-CW5SX0aM.js";import{T as W}from"./textarea-89MP2Dvt.js";import{L as Y}from"./label-DXp3vw-p.js";import{u as Z}from"./toaster-CR_CLjT4.js";import{c as p}from"./index-DEGu_kMU.js";import{U as J}from"./users-Bum_EUm8.js";import{S as K}from"./save-CRMEmS-8.js";import"./Dropdown--SqrWfdR.js";import"./transition-B8_0YiEE.js";import"./XMarkIcon-BajPl_Ya.js";import"./clipboard-check-BUpBKaMS.js";import"./index-CKryKcUP.js";import"./index-C6Troi14.js";import"./index-BYPC565r.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]],ee=p("badge-dollar-sign",X);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]],se=p("calendar-check",te);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",key:"1oijnt"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-.5",key:"1but9f"}],["path",{d:"M16 4h2a2 2 0 0 1 1.73 1",key:"1p8n7l"}],["path",{d:"M8 18h1",key:"13wk12"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}]],re=p("clipboard-pen-line",ae);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ie=p("info",le);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]],ne=p("message-square-text",ce);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],de=p("package",oe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],$=p("scan-line",me),x=({icon:l,label:a,children:r,error:c,className:N=""})=>e.jsxs("div",{className:`flex flex-col gap-2 ${N}`,children:[e.jsxs(Y,{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[l,a]}),r,c&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c})]}),xe=()=>{const l=new Date,a=l.getFullYear(),r=String(l.getMonth()+1).padStart(2,"0"),c=String(l.getDate()).padStart(2,"0");return`${a}-${r}-${c}`};function De({po:l,inspectionCommittee:a}){var S;const{data:r,setData:c,post:N,processing:w,errors:o}=B({po_id:l.id,iar_number:l.po_number,date_received:xe(),inspection_committee_id:(a==null?void 0:a.id)||"",items:(l.details||[]).map(t=>{var d,i,n;const s=(n=(i=(d=l.rfq)==null?void 0:d.purchase_request)==null?void 0:i.details)==null?void 0:n.find(m=>m.id===t.pr_detail_id);return{pr_details_id:t.pr_detail_id,product_name:(s==null?void 0:s.item)||"Unknown Item",specs:(s==null?void 0:s.specs)||"No specs provided",quantity_ordered:parseFloat(t.quantity||0),unit_price:parseFloat(t.unit_price||0),quantity_received:"",remarks:"",total_price:0}}),committee_members:((a==null?void 0:a.members)||[]).map(t=>({id:t.id,name:t.name,position:t.position,status:t.status}))}),[A,g]=f.useState(!1),{toast:j}=Z(),k=(t,s,d)=>{c("items",r.items.map((i,n)=>{if(n===t){const m={...i};if(s==="quantity_received"){let v=parseFloat(d)||0;v>i.quantity_ordered&&(v=i.quantity_ordered),m.quantity_received=v,m.total_price=v*m.unit_price}else m[s]=d;return m}return i}))},O=f.useMemo(()=>r.items.reduce((t,s)=>t+s.total_price,0),[r.items]),L=t=>{t.preventDefault(),g(!0)},P=()=>{N(route("supply_officer.store_iar"),{preserveScroll:!0,onSuccess:()=>{g(!1),j({title:"IAR Recorded",description:"Inspection & Acceptance Report successfully saved!",duration:3e3})},onError:t=>{g(!1),console.error("IAR Save Error:",t),j({title:"Save Failed",description:"Please review the inputs and try again.",variant:"destructive",duration:4e3})}})},[T,y]=f.useState(!1),[u,E]=f.useState(null),[_,R]=f.useState(""),H=t=>{E(t),R(""),y(!0)},U=()=>{Q.post(route("inspection.committee.replace-member",{id:a==null?void 0:a.id}),{member_id:u.id,replacementName:_},{preserveScroll:!0,onSuccess:()=>{c("committee_members",r.committee_members.map(t=>t.id===u.id?{...t,status:"inactive"}:t).concat({id:Date.now(),name:_,position:u.position,status:"active"})),y(!1),j({title:"Member Replaced",description:"Inspection Committee updated successfully!",duration:3e3})},onError:t=>{y(!1),console.error("Member Replace Error:",t),j({title:"Replace Failed",description:"Please check inputs and try again.",variant:"destructive",duration:4e3})}})};return e.jsxs(G,{header:"Schools Divisions Office - Ilagan | Record Inspection and Acceptance",children:[e.jsx(V,{title:"Record IAR"}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 p-4 sm:p-6 md:p-10",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm p-6 sm:p-8 md:p-10 shadow-2xl rounded-2xl max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8 pb-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-extrabold text-gray-900 leading-tight",children:"Record Inspection and Acceptance Report"}),e.jsxs("p",{className:"text-base sm:text-lg text-gray-600 mt-2",children:["For Purchase Order"," ",e.jsxs("span",{className:"font-semibold text-blue-700",children:["#",l.po_number]})]})]}),Object.keys(o).length>0&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Please correct the following:"}),e.jsx("ul",{className:"list-disc list-inside text-sm",children:Object.entries(o).map(([t,s])=>!t.startsWith("items.")&&e.jsx("li",{children:s},t))})]}),e.jsxs("form",{onSubmit:L,className:"space-y-10",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold text-gray-800 flex items-center gap-2 sm:gap-3",children:[e.jsx(re,{className:"text-blue-600",size:22}),"Global Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-6 border border-blue-100 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 shadow-sm",children:[e.jsx(x,{icon:e.jsx($,{size:18,className:"text-gray-500"}),label:"IAR Number",error:o.iar_number,children:e.jsx(b,{type:"text",value:r.iar_number,onChange:t=>c("iar_number",t.target.value),placeholder:"Enter IAR Number",className:"h-12 text-base",required:!0})}),e.jsx(x,{icon:e.jsx(se,{size:18,className:"text-gray-500"}),label:"Date Received",error:o.date_received,children:e.jsx(b,{type:"date",value:r.date_received,onChange:t=>c("date_received",t.target.value),className:"h-12 text-base focus-visible:ring-yellow-400 bg-gray-50",required:!0})})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold text-gray-800 flex items-center gap-2 sm:gap-3",children:[e.jsx(q,{className:"text-blue-600",size:22}),"Received Items"]}),e.jsx("div",{className:"grid gap-6",children:r.items.map((t,s)=>{const d=(parseFloat(t.quantity_received)||0)*t.unit_price,i=parseFloat(t.quantity_received||0)!==t.quantity_ordered&&parseFloat(t.quantity_received||0)>0;return e.jsxs("div",{className:"bg-gradient-to-br from-blue-100 to-white border border-blue-100 rounded-xl p-6 shadow-md hover:shadow-lg transition",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 pb-4 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg sm:text-xl font-semibold text-blue-800",children:t.product_name}),e.jsx("p",{className:"text-sm sm:text-md text-gray-600 mt-1",children:t.specs})]}),e.jsxs("div",{className:"text-right mt-4 sm:mt-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-500 flex items-center justify-end gap-1",children:[e.jsx(ee,{size:14})," Unit Price"]}),e.jsxs("p",{className:"text-xl sm:text-2xl font-bold text-green-700",children:["â‚±",t.unit_price.toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6",children:[e.jsx(x,{icon:e.jsx(de,{size:16}),label:"Quantity Ordered",children:e.jsx(b,{type:"text",className:"text-center font-bold h-12 border-gray-200 cursor-not-allowed",value:t.quantity_ordered,readOnly:!0})}),e.jsxs(x,{icon:e.jsx(q,{size:16}),label:"Quantity Received *",error:o[`items.${s}.quantity_received`],children:[e.jsx(b,{type:"number",className:`text-center focus-visible:ring-yellow-400 bg-gray-50 font-bold h-12 ${i?"border-yellow-500 focus-visible:ring-yellow-400":"border-gray-300"}`,value:t.quantity_received,onChange:n=>k(s,"quantity_received",n.target.value),min:"0",placeholder:"Quantity Received",required:!0}),i&&e.jsxs("p",{className:"text-yellow-600 text-xs mt-1 flex items-center gap-1",children:[e.jsx(ie,{size:12})," Discrepancy with ordered qty"]})]}),e.jsx(x,{icon:e.jsx($,{size:16}),label:"Total for Item",children:e.jsx(b,{type:"text",className:"bg-blue-50 text-blue-800 text-center font-extrabold h-12 border-blue-200 cursor-not-allowed",value:d.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),readOnly:!0})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(x,{icon:e.jsx(ne,{size:16}),label:"Remarks",error:o[`items.${s}.remarks`],children:e.jsx(W,{placeholder:"Add remarks (e.g., damaged, incomplete)",value:t.remarks,onChange:n=>k(s,"remarks",n.target.value),rows:3,className:"min-h-[70px] focus-visible:ring-yellow-400 bg-gray-50",required:!0})})})]},t.pr_details_id)})})]}),e.jsxs("section",{className:"border-t border-gray-200 pt-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-2 p-6 border border-blue-100 rounded-xl bg-blue-50/70 shadow-sm",children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold mb-4 text-gray-800 flex items-center gap-2",children:[e.jsx(J,{size:20,className:"text-blue-600"}),"Inspection Committee"]}),e.jsx("ul",{className:"space-y-3",children:(S=r.committee_members)==null?void 0:S.filter(t=>t.status==="active").sort((t,s)=>t.position.toLowerCase().includes("leader")?-1:s.position.toLowerCase().includes("leader")?1:0).map(t=>e.jsxs("li",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center bg-blue-50 p-4 rounded-lg shadow-sm border border-blue-100",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.position})]}),e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:()=>H(t),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:"Replace"})]},t.id))})]}),e.jsx("div",{className:"lg:col-span-1 flex justify-center lg:justify-end",children:e.jsxs("div",{className:"text-center p-6 sm:p-8 rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-md w-full sm:w-auto",children:[e.jsx("p",{className:"text-base sm:text-lg font-semibold mb-2 opacity-90",children:"Grand Total Received"}),e.jsxs("p",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold tracking-tight break-words",children:["â‚±",O.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{type:"submit",className:"px-8 sm:px-10 py-3 sm:py-4 text-base sm:text-lg bg-blue-700 hover:bg-blue-800 text-white flex items-center gap-2 shadow-md hover:shadow-lg transition rounded-xl",children:[e.jsx(K,{size:18}),"Save Inspection Report"]})})]})]})]})}),e.jsx(M,{open:T,onOpenChange:y,children:e.jsxs(I,{className:"sm:max-w-md p-6",children:[e.jsxs(D,{children:[e.jsx(z,{className:"text-2xl font-bold",children:"Replace Committee Member"}),e.jsxs(C,{className:"text-md text-gray-600",children:["Replace ",e.jsx("strong",{className:"text-blue-700",children:u==null?void 0:u.name})," with a new inspector."]})]}),e.jsxs(x,{label:"New Inspector Name",className:"mt-4",error:o.replacementName,children:[" ",e.jsx(b,{type:"text",value:_,onChange:t=>R(t.target.value),placeholder:"Enter new inspector's full name",className:"h-10 text-base"})]}),e.jsxs(F,{className:"mt-6 flex justify-end gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>y(!1),className:"px-6 py-2",children:"Cancel"}),e.jsx(h,{onClick:U,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700",children:"Confirm Replace"})]})]})}),e.jsx(M,{open:A,onOpenChange:g,children:e.jsxs(I,{className:"sm:max-w-md p-6",children:[e.jsxs(D,{children:[e.jsx(z,{className:"text-2xl font-bold",children:"Confirm Record IAR"}),e.jsx(C,{className:"text-md text-gray-600",children:"Are you sure you want to record this Inspection & Acceptance Report? Please ensure all details are correct."})]}),e.jsxs(F,{className:"mt-6 flex justify-end gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>g(!1),className:"px-6 py-2",children:"Cancel"}),e.jsx(h,{disabled:w,onClick:P,className:"px-6 py-2 bg-green-600 hover:bg-green-700",children:w?"Saving...":"Confirm"})]})]})})]})}export{De as default};
