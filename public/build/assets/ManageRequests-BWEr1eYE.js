import{q as z,r,m as d,j as t,$ as B}from"./app-93n4-YE1.js";import{T as K}from"./Tooltip-BDMbMjY5.js";import{u as Y}from"./toaster-CR_CLjT4.js";import{R as V}from"./RequesterLayout-Cbv_OArf.js";import"./sweetalert2.esm.all-BQIkj5Wb.js";import{D as v,a as y,b as S,c as w,d as N,e as I}from"./dialog-dmNlH9AS.js";import{B as h}from"./button-b6E2TuAP.js";import{S as G}from"./send-horizontal-DQjArJOU.js";import{c as J}from"./index-DEGu_kMU.js";import{C as Q}from"./circle-check-DncXL_LL.js";import"./index-BYPC565r.js";import"./index-C6Troi14.js";import"./Dropdown--SqrWfdR.js";import"./transition-B8_0YiEE.js";import"./XMarkIcon-BajPl_Ya.js";import"./BellAlertIcon-DQ7YZFl9.js";import"./index-CKryKcUP.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],W=J("printer",U);function he({purchaseRequests:l,search:C,month:P}){const{props:c}=z(),[p,R]=r.useState(C||""),[x,A]=r.useState(P||""),[m,D]=r.useState({}),[M,f]=r.useState(!1),[q,E]=r.useState(""),{toast:k}=Y(),[_,b]=r.useState(!1),[a,i]=r.useState({open:!1,prId:null,text:""}),[o,g]=r.useState({open:!1,success:!0,title:"",text:""});r.useEffect(()=>{const e=localStorage.getItem("flashSuccess"),s=localStorage.getItem("highlightPrId");e&&(E(e),f(!0),k({title:"PR Submitted",description:e,className:"bg-green-500 text-white",duration:3e3}),localStorage.removeItem("flashSuccess")),s&&(j(Number(s)),localStorage.removeItem("highlightPrId"))},[]);const[O,j]=r.useState(null);r.useEffect(()=>{const e=localStorage.getItem("highlightPrId");e&&c.highlightPrId?(j(e),localStorage.removeItem("highlightPrId")):c.highlightPrId&&j(c.highlightPrId)},[c.highlightPrId]);const T=r.useMemo(()=>Array.from({length:12},(e,s)=>({value:s+1,label:new Date(0,s).toLocaleString("default",{month:"long"})})),[]);r.useCallback((e,s,n)=>{setAlertDialog({open:!0,title:s,text:n,success:e})},[]);const F=r.useCallback((e,s)=>{const n=e.target.files[0];n&&D(u=>({...u,[s]:n}))},[]),$=r.useCallback(e=>{i({open:!0,prId:e,text:"You won't be able to edit this PR after sending."})},[]),L=r.useCallback(()=>{if(!a.prId)return;b(!0);const e=a.prId,s=new FormData;m[e]&&s.append("approval_image",m[e]),d.post(route("requester.pr.send_for_approval",e),s,{forceFormData:!0,preserveScroll:!0,preserveState:!0,onSuccess:()=>{g({open:!0,success:!0,title:"Sent!",text:"The approved PR form has been sent."}),k({title:"PR Sent",description:"PR is sent for approval",className:"bg-green-500 text-white",duration:3e3}),D(n=>{const u={...n};return delete u[e],u}),i({open:!1,prId:null,text:""}),b(!1)},onError:()=>{g({open:!0,success:!1,title:"Error",text:"Failed to send approved PR form."}),i({open:!1,prId:null,text:""}),b(!1)}})},[a.prId,m]),H=r.useCallback(e=>{window.open(route("requester.print",e),"_blank")},[]);return r.useEffect(()=>{if(p===(C||"")&&x===(P||""))return;const e=setTimeout(()=>{d.get(route("requester.manage_requests"),{search:p,month:x},{preserveScroll:!0,preserveState:!0,replace:!0})},300);return()=>clearTimeout(e)},[p,x]),r.useEffect(()=>{let e;return(()=>{e=setInterval(()=>{document.visibilityState==="visible"&&d.reload({only:["purchaseRequests"],preserveScroll:!0,preserveState:!0})},1e4)})(),()=>clearInterval(e)},[]),t.jsxs(V,{header:"Schools Division Office - Ilagan | Manage Requests",children:[t.jsx(B,{title:"Manage Requests"}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6 border border-gray-200",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Your Purchase Requests"}),t.jsx("button",{onClick:()=>d.get(route("requester.create")),className:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-5 py-2 rounded-md shadow",children:"+ Create PR"})]}),t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-3 mb-5",children:[t.jsxs("p",{className:"text-gray-600 text-sm",children:["Showing ",l.from??0," - ",l.to??0," of ",l.total??0," requests"]}),t.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[t.jsx("input",{type:"text",value:p,onChange:e=>R(e.target.value),placeholder:"Search PR # or purpose...",className:"px-4 py-2 border border-gray-300 rounded-md text-sm w-full md:w-64"}),t.jsxs("select",{value:x,onChange:e=>A(e.target.value),className:"px-10 py-2 border border-gray-300 rounded-md text-sm",children:[t.jsx("option",{value:"",children:"All Months"}),T.map(({value:e,label:s})=>t.jsx("option",{value:e,children:s},e))]})]})]}),t.jsxs("div",{className:"overflow-x-auto rounded-md border border-gray-200 shadow-sm bg-white",children:[t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsx("tr",{children:["PR Number","Purpose","Status","Date Created","Signed PR Form","Actions"].map(e=>t.jsx("th",{className:"px-6 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider",children:e},e))})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.data.map(e=>t.jsxs("tr",{id:`pr-${e.id}`,className:`hover:bg-indigo-50 transition duration-200 ${e.id===O?"bg-green-100":""}`,children:[t.jsx("td",{className:"px-6 py-4 text-center text-indigo-600 font-medium",children:e.is_sent===0&&e.status!=="Approved"?t.jsx(K,{to:route("requester.add_details",e.id),tooltip:"Edit PR",className:"hover:underline text-indigo-600",children:e.pr_number}):t.jsx("span",{className:"text-gray-500 cursor-not-allowed",children:e.pr_number})}),t.jsx("td",{className:"px-6 py-4 text-center text-gray-700",children:e.purpose}),t.jsx("td",{className:"px-6 py-4 text-center",children:t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${e.status==="Approved"?"bg-green-100 text-green-800":e.status==="Pending"?"bg-yellow-100 text-yellow-800":e.status==="Rejected"?"bg-red-100 text-red-800":"bg-gray-200 text-gray-800"}`,children:e.status})}),t.jsx("td",{className:"px-6 py-4 text-center text-gray-600 text-sm font-mono",children:new Date(e.created_at).toLocaleDateString()}),t.jsx("td",{className:"px-6 py-4 text-center",children:e.is_sent===0?t.jsx("input",{type:"file",accept:"image/*",onChange:s=>F(s,e.id),className:"text-sm px-2 py-1 border border-gray-300 rounded-md"}):t.jsx("span",{className:"text-green-600 font-medium text-sm",children:"Approved form already sent"})}),t.jsxs("td",{className:"px-6 py-4 text-center space-x-2",children:[e.is_sent===0&&t.jsxs("div",{className:"relative group inline-block",children:[t.jsx("button",{onClick:()=>$(e.id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-sm",children:t.jsx(G,{})}),t.jsx("span",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap",children:"Send for Approval"})]}),t.jsxs("div",{className:"relative group inline-block",children:[t.jsx("button",{onClick:()=>H(e.id),className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded-md text-sm",children:t.jsx(W,{})}),t.jsx("span",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap",children:"Print"})]})]})]},e.id))})]}),l.links.length>3&&t.jsx("div",{className:"flex justify-center items-center gap-2 mt-6 flex-wrap",children:l.links.map((e,s)=>t.jsx("button",{disabled:!e.url,onClick:()=>e.url&&d.visit(e.url,{preserveScroll:!0,preserveState:!0}),className:`px-4 py-2 text-sm rounded-md border transition ${e.active?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 hover:bg-gray-100 border-gray-300"} ${!e.url&&"opacity-50 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:e.label}},s))})]})]}),t.jsx(v,{open:M,onOpenChange:f,children:t.jsxs(y,{children:[t.jsxs(S,{children:[t.jsxs(w,{className:"flex items-center gap-2 text-green-600",children:[t.jsx(Q,{size:24}),"Success!"]}),t.jsx(N,{className:"pt-4 text-base",children:q})]}),t.jsx(I,{children:t.jsx(h,{onClick:()=>f(!1),children:"OK"})})]})}),t.jsx(v,{open:a.open,onOpenChange:e=>i({...a,open:e}),children:t.jsxs(y,{children:[t.jsxs(S,{children:[t.jsx(w,{children:"Send for Approval?"}),t.jsx(N,{children:a.text})]}),t.jsxs(I,{className:"flex justify-between gap-2",children:[t.jsx(h,{variant:"outline",onClick:()=>i({...a,open:!1}),children:"Cancel"}),t.jsx(h,{onClick:L,disabled:_,children:_?"Sending...":"Confirm"})]})]})}),t.jsx(v,{open:o.open,onOpenChange:e=>g({...o,open:e}),children:t.jsxs(y,{children:[t.jsxs(S,{children:[t.jsxs(w,{className:o.success?"text-green-600":"text-red-600",children:[o.success?"✅ ":"❌ "," ",o.title]}),t.jsx(N,{children:o.text})]}),t.jsx(I,{children:t.jsx(h,{onClick:()=>g({...o,open:!1}),children:"OK"})})]})})]})}export{he as default};
