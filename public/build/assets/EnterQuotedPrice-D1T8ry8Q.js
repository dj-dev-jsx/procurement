import{R as pt,r as d,v as mt,q as bt,j as t,$ as gt,m as pe,a as xt}from"./app-93n4-YE1.js";import{A as ht}from"./ApproverLayout-CJpNhpE3.js";import{D as Pe,a as Te,b as Le,c as Fe,d as ke,e as De}from"./dialog-dmNlH9AS.js";import{S as ee}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{u as vt}from"./toaster-CR_CLjT4.js";import{S as yt}from"./scroll-text-Cu09ylES.js";import{F as wt}from"./file-plus-2-B58za7JO.js";import{F as $t}from"./PencilSquareIcon-BtsTF4Sc.js";import{T as jt}from"./trash-2-DGMdvtDV.js";import{S as Et}from"./save-CRMEmS-8.js";import{C as St}from"./circle-check-DncXL_LL.js";import{o as Nt,a as _t}from"./disabled-BcXQ8RzQ.js";import{p as Ct,o as Ae,K as Pt,_ as Tt,L as Lt}from"./transition-B8_0YiEE.js";import"./Dropdown--SqrWfdR.js";import"./XMarkIcon-BajPl_Ya.js";import"./ClipboardDocumentIcon-rUgeVu8g.js";import"./clipboard-check-BUpBKaMS.js";import"./index-DEGu_kMU.js";import"./index-C6Troi14.js";import"./index-BYPC565r.js";import"./circle-check-big-CDYAS76j.js";import"./file-text-BWCkVFPU.js";import"./BellAlertIcon-DQ7YZFl9.js";import"./index-CKryKcUP.js";const He=typeof document<"u"?pt.useLayoutEffect:()=>{};function Ft(e){const r=d.useRef(null);return He(()=>{r.current=e},[e]),d.useCallback((...s)=>{const i=r.current;return i==null?void 0:i(...s)},[])}const M=e=>{var r;return(r=e==null?void 0:e.ownerDocument)!==null&&r!==void 0?r:document},H=e=>e&&"window"in e&&e.window===e?e:M(e).defaultView||window;function kt(e){return e!==null&&typeof e=="object"&&"nodeType"in e&&typeof e.nodeType=="number"}function Dt(e){return kt(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"host"in e}let At=!1;function ye(){return At}function Oe(e,r){if(!ye())return r&&e?e.contains(r):!1;if(!e||!r)return!1;let s=r;for(;s!==null;){if(s===e)return!0;s.tagName==="SLOT"&&s.assignedSlot?s=s.assignedSlot.parentNode:Dt(s)?s=s.host:s=s.parentNode}return!1}const be=(e=document)=>{var r;if(!ye())return e.activeElement;let s=e.activeElement;for(;s&&"shadowRoot"in s&&(!((r=s.shadowRoot)===null||r===void 0)&&r.activeElement);)s=s.shadowRoot.activeElement;return s};function Be(e){return ye()&&e.target.shadowRoot&&e.composedPath?e.composedPath()[0]:e.target}function Mt(e){var r;return typeof window>"u"||window.navigator==null?!1:((r=window.navigator.userAgentData)===null||r===void 0?void 0:r.brands.some(s=>e.test(s.brand)))||e.test(window.navigator.userAgent)}function Ht(e){var r;return typeof window<"u"&&window.navigator!=null?e.test(((r=window.navigator.userAgentData)===null||r===void 0?void 0:r.platform)||window.navigator.platform):!1}function Re(e){let r=null;return()=>(r==null&&(r=e()),r)}const Ot=Re(function(){return Ht(/^Mac/i)}),Bt=Re(function(){return Mt(/Android/i)});function Ie(){let e=d.useRef(new Map),r=d.useCallback((o,p,m,u)=>{let b=u!=null&&u.once?(...g)=>{e.current.delete(m),m(...g)}:m;e.current.set(m,{type:p,eventTarget:o,fn:b,options:u}),o.addEventListener(p,b,u)},[]),s=d.useCallback((o,p,m,u)=>{var b;let g=((b=e.current.get(m))===null||b===void 0?void 0:b.fn)||m;o.removeEventListener(p,g,u),e.current.delete(m)},[]),i=d.useCallback(()=>{e.current.forEach((o,p)=>{s(o.eventTarget,o.type,p,o.options)})},[s]);return d.useEffect(()=>i,[i]),{addGlobalListener:r,removeGlobalListener:s,removeAllGlobalListeners:i}}function Rt(e){return e.mozInputSource===0&&e.isTrusted?!0:Bt()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function We(e){let r=e;return r.nativeEvent=e,r.isDefaultPrevented=()=>r.defaultPrevented,r.isPropagationStopped=()=>r.cancelBubble,r.persist=()=>{},r}function It(e,r){Object.defineProperty(e,"target",{value:r}),Object.defineProperty(e,"currentTarget",{value:r})}function Qe(e){let r=d.useRef({isFocused:!1,observer:null});He(()=>{const i=r.current;return()=>{i.observer&&(i.observer.disconnect(),i.observer=null)}},[]);let s=Ft(i=>{e==null||e(i)});return d.useCallback(i=>{if(i.target instanceof HTMLButtonElement||i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement||i.target instanceof HTMLSelectElement){r.current.isFocused=!0;let o=i.target,p=m=>{if(r.current.isFocused=!1,o.disabled){let u=We(m);s(u)}r.current.observer&&(r.current.observer.disconnect(),r.current.observer=null)};o.addEventListener("focusout",p,{once:!0}),r.current.observer=new MutationObserver(()=>{if(r.current.isFocused&&o.disabled){var m;(m=r.current.observer)===null||m===void 0||m.disconnect();let u=o===document.activeElement?null:document.activeElement;o.dispatchEvent(new FocusEvent("blur",{relatedTarget:u})),o.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:u}))}}),r.current.observer.observe(o,{attributes:!0,attributeFilter:["disabled"]})}},[s])}let Wt=!1,U=null,ge=new Set,K=new Map,O=!1,xe=!1;const Qt={Tab:!0,Escape:!0};function we(e,r){for(let s of ge)s(e,r)}function Vt(e){return!(e.metaKey||!Ot()&&e.altKey||e.ctrlKey||e.key==="Control"||e.key==="Shift"||e.key==="Meta")}function re(e){O=!0,Vt(e)&&(U="keyboard",we("keyboard",e))}function Q(e){U="pointer",(e.type==="mousedown"||e.type==="pointerdown")&&(O=!0,we("pointer",e))}function Ve(e){Rt(e)&&(O=!0,U="virtual")}function Ge(e){e.target===window||e.target===document||Wt||!e.isTrusted||(!O&&!xe&&(U="virtual",we("virtual",e)),O=!1,xe=!1)}function Ke(){O=!1,xe=!0}function he(e){if(typeof window>"u"||K.get(H(e)))return;const r=H(e),s=M(e);let i=r.HTMLElement.prototype.focus;r.HTMLElement.prototype.focus=function(){O=!0,i.apply(this,arguments)},s.addEventListener("keydown",re,!0),s.addEventListener("keyup",re,!0),s.addEventListener("click",Ve,!0),r.addEventListener("focus",Ge,!0),r.addEventListener("blur",Ke,!1),typeof PointerEvent<"u"&&(s.addEventListener("pointerdown",Q,!0),s.addEventListener("pointermove",Q,!0),s.addEventListener("pointerup",Q,!0)),r.addEventListener("beforeunload",()=>{Ue(e)},{once:!0}),K.set(r,{focus:i})}const Ue=(e,r)=>{const s=H(e),i=M(e);r&&i.removeEventListener("DOMContentLoaded",r),K.has(s)&&(s.HTMLElement.prototype.focus=K.get(s).focus,i.removeEventListener("keydown",re,!0),i.removeEventListener("keyup",re,!0),i.removeEventListener("click",Ve,!0),s.removeEventListener("focus",Ge,!0),s.removeEventListener("blur",Ke,!1),typeof PointerEvent<"u"&&(i.removeEventListener("pointerdown",Q,!0),i.removeEventListener("pointermove",Q,!0),i.removeEventListener("pointerup",Q,!0)),K.delete(s))};function Gt(e){const r=M(e);let s;return r.readyState!=="loading"?he(e):(s=()=>{he(e)},r.addEventListener("DOMContentLoaded",s)),()=>Ue(e,s)}typeof document<"u"&&Gt();function qe(){return U!=="pointer"}const Kt=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function Ut(e,r,s){let i=M(s==null?void 0:s.target);const o=typeof window<"u"?H(s==null?void 0:s.target).HTMLInputElement:HTMLInputElement,p=typeof window<"u"?H(s==null?void 0:s.target).HTMLTextAreaElement:HTMLTextAreaElement,m=typeof window<"u"?H(s==null?void 0:s.target).HTMLElement:HTMLElement,u=typeof window<"u"?H(s==null?void 0:s.target).KeyboardEvent:KeyboardEvent;return e=e||i.activeElement instanceof o&&!Kt.has(i.activeElement.type)||i.activeElement instanceof p||i.activeElement instanceof m&&i.activeElement.isContentEditable,!(e&&r==="keyboard"&&s instanceof u&&!Qt[s.key])}function qt(e,r,s){he(),d.useEffect(()=>{let i=(o,p)=>{Ut(!!(s!=null&&s.isTextInput),o,p)&&e(qe())};return ge.add(i),()=>{ge.delete(i)}},r)}function zt(e){let{isDisabled:r,onFocus:s,onBlur:i,onFocusChange:o}=e;const p=d.useCallback(b=>{if(b.target===b.currentTarget)return i&&i(b),o&&o(!1),!0},[i,o]),m=Qe(p),u=d.useCallback(b=>{const g=M(b.target),E=g?be(g):be();b.target===b.currentTarget&&E===Be(b.nativeEvent)&&(s&&s(b),o&&o(!0),m(b))},[o,s,m]);return{focusProps:{onFocus:!r&&(s||o||i)?u:void 0,onBlur:!r&&(i||o)?p:void 0}}}function Yt(e){let{isDisabled:r,onBlurWithin:s,onFocusWithin:i,onFocusWithinChange:o}=e,p=d.useRef({isFocusWithin:!1}),{addGlobalListener:m,removeAllGlobalListeners:u}=Ie(),b=d.useCallback(h=>{h.currentTarget.contains(h.target)&&p.current.isFocusWithin&&!h.currentTarget.contains(h.relatedTarget)&&(p.current.isFocusWithin=!1,u(),s&&s(h),o&&o(!1))},[s,o,p,u]),g=Qe(b),E=d.useCallback(h=>{if(!h.currentTarget.contains(h.target))return;const P=M(h.target),j=be(P);if(!p.current.isFocusWithin&&j===Be(h.nativeEvent)){i&&i(h),o&&o(!0),p.current.isFocusWithin=!0,g(h);let _=h.currentTarget;m(P,"focus",v=>{if(p.current.isFocusWithin&&!Oe(_,v.target)){let S=new P.defaultView.FocusEvent("blur",{relatedTarget:v.target});It(S,_);let T=We(S);b(T)}},{capture:!0})}},[i,o,g,m,b]);return r?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:E,onBlur:b}}}let ve=!1,me=0;function Xt(){ve=!0,setTimeout(()=>{ve=!1},50)}function Me(e){e.pointerType==="touch"&&Xt()}function Jt(){if(!(typeof document>"u"))return typeof PointerEvent<"u"&&document.addEventListener("pointerup",Me),me++,()=>{me--,!(me>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",Me)}}function Zt(e){let{onHoverStart:r,onHoverChange:s,onHoverEnd:i,isDisabled:o}=e,[p,m]=d.useState(!1),u=d.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;d.useEffect(Jt,[]);let{addGlobalListener:b,removeAllGlobalListeners:g}=Ie(),{hoverProps:E,triggerHoverEnd:h}=d.useMemo(()=>{let P=(v,S)=>{if(u.pointerType=S,o||S==="touch"||u.isHovered||!v.currentTarget.contains(v.target))return;u.isHovered=!0;let T=v.currentTarget;u.target=T,b(M(v.target),"pointerover",k=>{u.isHovered&&u.target&&!Oe(u.target,k.target)&&j(k,k.pointerType)},{capture:!0}),r&&r({type:"hoverstart",target:T,pointerType:S}),s&&s(!0),m(!0)},j=(v,S)=>{let T=u.target;u.pointerType="",u.target=null,!(S==="touch"||!u.isHovered||!T)&&(u.isHovered=!1,g(),i&&i({type:"hoverend",target:T,pointerType:S}),s&&s(!1),m(!1))},_={};return typeof PointerEvent<"u"&&(_.onPointerEnter=v=>{ve&&v.pointerType==="mouse"||P(v,v.pointerType)},_.onPointerLeave=v=>{!o&&v.currentTarget.contains(v.target)&&j(v,v.pointerType)}),{hoverProps:_,triggerHoverEnd:j}},[r,s,i,o,u,b,g]);return d.useEffect(()=>{o&&h({currentTarget:u.target},u.pointerType)},[o]),{hoverProps:E,isHovered:p}}function er(e={}){let{autoFocus:r=!1,isTextInput:s,within:i}=e,o=d.useRef({isFocused:!1,isFocusVisible:r||qe()}),[p,m]=d.useState(!1),[u,b]=d.useState(()=>o.current.isFocused&&o.current.isFocusVisible),g=d.useCallback(()=>b(o.current.isFocused&&o.current.isFocusVisible),[]),E=d.useCallback(j=>{o.current.isFocused=j,m(j),g()},[g]);qt(j=>{o.current.isFocusVisible=j,g()},[],{isTextInput:s});let{focusProps:h}=zt({isDisabled:i,onFocusChange:E}),{focusWithinProps:P}=Yt({isDisabled:!i,onFocusWithinChange:E});return{isFocused:p,isFocusVisible:u,focusProps:i?P:h}}function tr(e){let r=e.width/2,s=e.height/2;return{top:e.clientY-s,right:e.clientX+r,bottom:e.clientY+s,left:e.clientX-r}}function rr(e,r){return!(!e||!r||e.right<r.left||e.left>r.right||e.bottom<r.top||e.top>r.bottom)}function nr({disabled:e=!1}={}){let r=d.useRef(null),[s,i]=d.useState(!1),o=Ct(),p=Ae(()=>{r.current=null,i(!1),o.dispose()}),m=Ae(u=>{if(o.dispose(),r.current===null){r.current=u.currentTarget,i(!0);{let b=Nt(u.currentTarget);o.addEventListener(b,"pointerup",p,!1),o.addEventListener(b,"pointermove",g=>{if(r.current){let E=tr(g);i(rr(E,r.current.getBoundingClientRect()))}},!1),o.addEventListener(b,"pointercancel",p,!1)}}});return{pressed:s,pressProps:e?{}:{onPointerDown:m,onPointerUp:p,onClick:p}}}let sr="button";function ir(e,r){var s;let i=_t(),{disabled:o=i||!1,autoFocus:p=!1,...m}=e,{isFocusVisible:u,focusProps:b}=er({autoFocus:p}),{isHovered:g,hoverProps:E}=Zt({isDisabled:o}),{pressed:h,pressProps:P}=nr({disabled:o}),j=Tt({ref:r,type:(s=m.type)!=null?s:"button",disabled:o||void 0,autoFocus:p},b,E,P),_=d.useMemo(()=>({disabled:o,hover:g,focus:u,active:h,autofocus:p}),[o,g,u,h,p]);return Lt()({ourProps:j,theirProps:m,slot:_,defaultTag:sr,name:"Button"})}let te=Pt(ir);function Lr({pr:e,suppliers:r,rfqs:s,purchaseRequest:i,rfq_details:o,categories:p}){var Ne,_e,Ce;const{toast:m}=vt();d.useEffect(()=>{if(o&&o.length>0){const n={};o.forEach(a=>{n[a.pr_details_id]||(n[a.pr_details_id]=[]),n[a.pr_details_id].includes(a.supplier_id)||n[a.pr_details_id].push(a.supplier_id)}),J(n)}},[o]);const[u,b]=d.useState(""),[g,E]=d.useState(null);d.useRef({});const[h,P]=d.useState(r??[]),[j,_]=d.useState(""),[v,S]=d.useState(1),T=5,[k,ze]=d.useState(""),[Ye,V]=d.useState(!1),[G,Xe]=d.useState({title:"",message:"",type:"success"}),[$e,ne]=d.useState(null),[q,F]=d.useState(null),[z,Y]=d.useState({}),[Je,B]=d.useState(!1),[$,Ze]=d.useState(null),[et,tt]=d.useState(!1),[rt,X]=d.useState(!1),[se,J]=d.useState({}),[R,I]=d.useState({representative_name:"",company_name:"",address:"",tin_num:"",category_id:""}),[ie,oe]=d.useState(()=>{const n={};return e.details&&e.details.forEach(a=>{n[a.id]=a.unit_price||""}),n}),{setData:ae}=mt({pr_id:e.id,user_id:((Ne=i==null?void 0:i.focal_person)==null?void 0:Ne.id)??null,supplier_id:"",selections:[]}),L=({title:n,message:a,type:c,onConfirm:l=null})=>{Xe({title:n,message:a,type:c}),ne(()=>l),V(!0)},nt=(n,a,c,l)=>{n.preventDefault();const f=l===""?null:l;L({title:"Confirm Submission",message:"Are you sure you want to submit this quoted price?",type:"confirm",onConfirm:()=>le(a,c,f)})},st=(n,a)=>{const c=o.find(l=>l.pr_details_id===n&&l.supplier_id===a);return(c==null?void 0:c.quoted_price)??null},le=(n,a,c,l=null)=>{const f=c===""?null:c,x={pr_id:e.id,pr_details_id:n,supplier_id:a,quoted_price:f},w=l||`${n}-${a}`;F(w),pe.post(route("bac_approver.submit_quoted"),x,{preserveScroll:!0,onSuccess:()=>{F(null),l&&ce(y=>{const N={...y};return delete N[l],N}),L({title:"Submitted!",message:"Quoted price submitted successfully.",type:"success"})},onError:y=>{F(null),L({title:"Oops!",message:(y==null?void 0:y.quoted_price)||"Something went wrong while submitting.",type:"error"})}})},it=()=>{L({title:"Confirm Bulk Submission",message:"Are you sure you want to submit all quoted prices?",type:"confirm",onConfirm:()=>ot()})},ot=()=>{if(!g)return;const n=e.details.map(a=>{const c=`${a.id}-${g}`,l=z[c],f=l===""?null:l;return l!==void 0?{pr_id:e.id,pr_details_id:a.id,supplier_id:g,quoted_price:f}:null}).filter(a=>a!==null);if(n.length===0){L({title:"No Prices to Submit",message:"Please enter at least one quoted price before submitting all.",type:"warning"});return}F("all"),pe.post(route("bac_approver.submit_bulk_quoted"),{quotes:n},{preserveScroll:!0,onSuccess:()=>{console.log("Bulk submitted successfully"),Y(a=>{const c={...a};return n.forEach(l=>{delete c[`${l.pr_details_id}-${l.supplier_id}`]}),c}),F(null),L({title:"All Quoted Prices Submitted!",message:"All prices for this supplier have been submitted successfully.",type:"success"})},onError:a=>{console.error("Bulk submission failed",a),F(null),L({title:"Oops!",message:(a==null?void 0:a.quoted_price)||"Something went wrong while submitting all prices.",type:"error"})}})},Z=(n,a,c)=>{ae(l=>{const f=(l.selections||[]).filter(x=>!(x.pr_detail_id===n&&x.supplier_id===a));return{...l,selections:[...f,{pr_detail_id:n,supplier_id:a,estimated_bid:c}]}})},at=n=>{Ze(n),tt(!1),B(!0);const a=e.details.find(c=>c.id===n);if(a){const c=a.unit_price||"";oe(l=>({...l,[n]:c})),ae(l=>({...l,estimated_bid:c}))}},{flash:D}=bt().props,lt=async n=>{var a,c;n.preventDefault();try{const f=(await xt.post(route("bac_approver.store_supplier"),R)).data.supplier;P(N=>[...N,f]),_(String(f.id));const x=f.id,y=($===null?"":ie[$]||"").toString().trim()||((c=(a=e.details)==null?void 0:a.find(N=>N.id===$))==null?void 0:c.unit_price)||"";$!==null?Z($,x,y):e.details.forEach(N=>{const C=N.unit_price||"";Z(N.id,x,C)}),I({company_name:"",address:"",tin_num:"",representative_name:"",category_id:null}),X(!1),B(!1)}catch(l){l.response?console.error("Server error:",l.response.data):console.error("Error adding supplier:",l.message),ee.fire("Error","Failed to add supplier. Please try again.","error")}};$&&((_e=e.details)!=null&&_e.length)&&e.details.find(n=>n.id===$);const je=h.filter(n=>{var c,l,f;if(!k)return!0;const a=k.toLowerCase();return((c=n.representative_name)==null?void 0:c.toLowerCase().includes(a))||((l=n.company_name)==null?void 0:l.toLowerCase().includes(a))||((f=n.address)==null?void 0:f.toLowerCase().includes(a))}).filter(n=>!o.some(a=>a.pr_details_id===$&&a.supplier_id===n.id));d.useEffect(()=>{S(1)},[k]);const de=Math.ceil(je.length/T),Ee=v*T,dt=Ee-T,Se=je.slice(dt,Ee),[W,ce]=d.useState({}),ct=(n,a,c)=>{F(c),pe.delete(route("bac_approver.delete_quoted"),{data:{pr_id:e.id,pr_details_id:n,supplier_id:a},preserveScroll:!0,onSuccess:()=>{F(null),Y(l=>{const f={...l};return delete f[c],f}),ce(l=>{const f={...l};return delete f[c],f}),J(l=>{const f={...l};return Array.isArray(f[n])&&(f[n]=f[n].filter(x=>x!==a),f[n].length===0&&delete f[n]),f}),m({title:"Deleted",description:"Quoted price removed successfully.",variant:"default",setTimeout:3e3}),L({title:"Deleted!"})},onFinish:l=>{F(null),D!=null&&D.message&&(m({title:D.status==="success"?"Deleted":"Error",description:D.message,variant:D.status==="success"?"default":"destructive",setTimeout:3e3}),L({title:D.status==="success"?"Deleted!":"Error!",description:D.message}))},onError:()=>{F(null),m({title:"Error",description:"Could not delete quoted price.",variant:"destructive",setTimeout:3e3}),L({title:"Error!"})}})},[ut,ue]=d.useState(!1),[or,ft]=d.useState([]);return t.jsxs(ht,{children:[t.jsx(gt,{title:"Enter Quoted Prices"}),t.jsxs("div",{className:"mx-auto px-6 py-10",children:[t.jsx("div",{className:"mb-8",children:t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx(yt,{className:"w-8 h-8 text-indigo-700"}),"Enter Quoted Prices for PR: ",e.pr_number]})}),t.jsx("div",{className:"mb-4",children:t.jsx("a",{type:"button",href:route("bac_approver.for_quotations"),className:"inline-flex items-center px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md text-sm shadow-sm",children:"â† Back"})}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2 border-b pb-2",children:[t.jsx(wt,{className:"w-5 h-5 text-indigo-600"}),"Purchase Request Info"]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"PR Number:"})," ",e.pr_number]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Purpose:"})," ",e.purpose]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Requested By:"})," ",e.requester_name]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Division:"})," ",e.division]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Created:"})," ",new Date(e.created_at).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Focal Person:"})," ",(Ce=i==null?void 0:i.focal_person)==null?void 0:Ce.firstname]})]})]}),t.jsxs("div",{className:"xl:col-span-2 space-y-10",children:[e.details.map(n=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("div",{className:"mb-4 border-b pb-3",children:[t.jsxs("h3",{className:"text-xl font-semibold text-gray-700",children:[n.item,t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",n.specs,")"]})]}),t.jsxs("div",{className:"text-sm text-gray-600 mt-2 grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Unit:"})," ",n.unit]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Quantity:"})," ",n.quantity]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Est. Price per Unit:"})," â‚±",Number(n.unit_price||0).toLocaleString()]})]})]}),t.jsx("div",{className:"mt-4 text-right",children:t.jsx("button",{onClick:()=>at(n.id),className:"inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-sm shadow-sm",children:"Choose Supplier"})}),t.jsx("div",{className:"space-y-6 mt-6",children:Array.isArray(se[n.id])&&se[n.id].map(a=>{const c=h.find(C=>C.id===a);if(!c)return null;const l=`${n.id}-${a}`,f=q===l,x=st(n.id,a),w=x!==null,y=n.unit_price||0,N=C=>{let A=parseFloat(C.target.value);isNaN(A)&&(A=""),A>y&&(A=y,ee.fire({icon:"warning",title:"Exceeded Unit Price",text:`Quoted price cannot exceed â‚±${y.toLocaleString()}.`,timer:2e3,showConfirmButton:!1})),Y(fe=>({...fe,[l]:A}))};return t.jsxs("form",{onSubmit:C=>{C.preventDefault();const A=z[l]??"",fe=!!W[l];w&&fe?le(n.id,a,A,l):nt(C,n.id,a,A)},className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center mt-4",children:[t.jsxs("div",{className:"md:col-span-4",children:[t.jsx("p",{className:"font-medium text-gray-800",children:c.representative_name}),t.jsx("p",{className:"text-xs text-gray-500",children:c.company_name})]}),t.jsxs("div",{className:"md:col-span-5 relative",children:[t.jsx("input",{type:"number",step:"0.01",placeholder:"â‚± Quoted Price",max:y,disabled:w&&!W[l],value:w&&!W[l]?parseFloat(x).toFixed(2):z[l]||"",onChange:N,className:`w-full border rounded-md px-4 py-2 text-sm shadow-sm ${w&&!W[l]?"bg-gray-100 border-gray-300 text-gray-500":"border-gray-300 focus:ring-2 focus:ring-indigo-500"}`}),w&&!W[l]&&t.jsx("span",{className:"absolute top-1/2 right-3 -translate-y-1/2 text-xs font-medium text-green-600",children:"Already submitted"})]}),t.jsx("div",{className:"md:col-span-3 flex gap-2",children:w&&!W[l]?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:()=>{ce(C=>({...C,[l]:!0})),Y(C=>({...C,[l]:x}))},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-yellow-500 hover:bg-yellow-600 text-white",children:t.jsx($t,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",disabled:f,onClick:()=>{L({title:"Confirm Delete",message:"Are you sure you want to delete this quoted price?",type:"confirm",onConfirm:()=>ct(n.id,a,l)})},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-red-600 hover:bg-red-700 text-white",children:t.jsx(jt,{className:"w-4 h-4"})})]}):w?t.jsx("button",{type:"button",disabled:f,onClick:()=>le(n.id,a,z[l]??"",l),className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${f?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx(Et,{className:"w-4 h-4"})}):t.jsx("button",{type:"submit",disabled:f,className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${f?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx(St,{className:"w-4 h-4"})})})]},l)})})]},n.id)),g&&t.jsx("div",{className:"mt-6 text-right",children:t.jsx("button",{onClick:it,disabled:q==="all",className:`inline-flex items-center gap-2 px-6 py-2 text-white text-sm font-semibold rounded-md shadow-sm transition ${q==="all"?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700"}`,children:q==="all"?"Submitting All...":"Submit Entire PR Quotes"})})]})]})]}),Je&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:t.jsxs("div",{className:"relative w-full max-w-7xl p-6 bg-white/90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-200",children:[t.jsx("button",{onClick:()=>B(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 transition-colors","aria-label":"Close modal",children:"âœ•"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Select a Supplier"}),t.jsx("div",{className:"flex justify-between items-center mb-5 gap-3",children:t.jsx("input",{type:"text",placeholder:"ðŸ” Filter suppliers...",value:k,onChange:n=>{ze(n.target.value),S(1)},className:"w-full max-w-xs border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"})}),t.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto rounded-lg border border-gray-200",children:t.jsxs("table",{className:"min-w-full text-sm text-gray-700",children:[t.jsx("thead",{className:"bg-gray-100 text-gray-600 uppercase text-xs tracking-wide",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"ID"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Name"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Company"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Category"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Address"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"TIN"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Action"})]})}),t.jsx("tbody",{children:Se.length>0?Se.map(n=>{var a;return t.jsxs("tr",{className:"hover:bg-indigo-50 transition-colors",children:[t.jsx("td",{className:"py-3 px-4",children:n.id}),t.jsx("td",{className:"py-3 px-4",children:n.representative_name}),t.jsx("td",{className:"py-3 px-4",children:n.company_name}),t.jsx("td",{className:"py-3 px-4",children:((a=p.find(c=>String(c.id)===String(n.category_id)))==null?void 0:a.name)||"N/A"}),t.jsx("td",{className:"py-3 px-4",children:n.address}),t.jsx("td",{className:"py-3 px-4",children:n.tin_num}),t.jsxs("td",{className:"py-3 px-4 space-x-2",children:[t.jsx("button",{disabled:o.some(c=>c.pr_details_id===$&&c.supplier_id===n.id),onClick:()=>{var f,x;const l=($===null?"":ie[$]||"").toString().trim()||((x=(f=e.details)==null?void 0:f.find(w=>w.id===$))==null?void 0:x.unit_price)||"";Z($,n.id,l),oe(w=>({...w,[$]:l})),J(w=>{const y=w[$]||[];return y.includes(n.id)?w:{...w,[$]:[...y,n.id]}}),_(String(n.id)),B(!1)},className:"text-sm bg-indigo-600 text-white hover:bg-indigo-700 px-3 py-1 rounded-lg shadow disabled:opacity-50 disabled:cursor-not-allowed",children:"Select"}),t.jsx("button",{onClick:()=>{const c={...se},l={...ie},f=[];e.details.forEach(x=>{if(o.some(y=>y.pr_details_id===x.id&&y.supplier_id===n.id))f.push(x.item_description||`Item #${x.id}`);else{const y=x.unit_price||"";l[x.id]=y,Z(x.id,n.id,y);const N=c[x.id]||[];N.includes(n.id)||(c[x.id]=[...N,n.id])}}),oe(l),J(c),_(String(n.id)),E(n.id),B(!1),f.length>0&&(ft(f),ue(!0))},className:"text-sm bg-green-600 text-white hover:bg-green-700 px-3 py-1 rounded-lg shadow",children:"Apply to Entire PR"})]})]},n.id)}):t.jsx("tr",{children:t.jsxs("td",{colSpan:"7",className:"text-center py-6 text-gray-400 italic",children:["No suppliers available for this"," ",et?"search":"category","."]})})})]})}),t.jsxs("div",{className:"mt-6 border-t pt-4 flex justify-between items-center",children:[t.jsx("button",{onClick:()=>X(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-lg text-sm shadow-sm",children:"âž• Add New Supplier"}),t.jsx("button",{onClick:()=>{if(!j){ee.fire("Oops!","Please select a supplier first.","warning");return}ae("supplier_id",j),B(!1),ee.fire("Saved!","Supplier has been selected.","success")},className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm shadow-sm",children:"Confirm Selection"})]}),t.jsxs("div",{className:"flex justify-between items-center mt-4",children:[t.jsx("button",{onClick:()=>S(n=>Math.max(n-1,1)),disabled:v===1,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"â† Prev"}),t.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",v," of ",de]}),t.jsx("button",{onClick:()=>S(n=>Math.min(n+1,de)),disabled:v===de,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"Next â†’"})]})]})}),rt&&t.jsx("div",{className:"fixed inset-0 z-[999] bg-black bg-opacity-50 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative",children:[t.jsx("button",{onClick:()=>X(!1),className:"absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold","aria-label":"Close add supplier modal",children:"Ã—"}),t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Supplier"}),t.jsxs("form",{onSubmit:lt,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Representative Name"}),t.jsx("input",{type:"text",required:!0,value:R.representative_name,onChange:n=>I(a=>({...a,representative_name:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name"}),t.jsx("input",{type:"text",required:!0,value:R.company_name,onChange:n=>I(a=>({...a,company_name:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),t.jsx("input",{type:"text",required:!0,value:R.address,onChange:n=>I(a=>({...a,address:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"TIN Number"}),t.jsx("input",{type:"text",required:!0,value:R.tin_num,onChange:n=>I(a=>({...a,tin_num:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),t.jsxs("select",{required:!0,value:R.category_id,onChange:n=>I(a=>({...a,category_id:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:[t.jsx("option",{value:"",children:"Select Category"}),p.map(n=>t.jsx("option",{value:n.id,children:n.name},n.id))]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>X(!1),className:"px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",children:"Add Supplier"})]})]})]})}),t.jsx(Pe,{open:Ye,onOpenChange:V,children:t.jsxs(Te,{children:[t.jsxs(Le,{children:[t.jsx(Fe,{className:G.type==="error"?"text-red-600":G.type==="success"?"text-green-600":"",children:G.title}),t.jsx(ke,{children:G.message})]}),t.jsx(De,{children:G.type==="confirm"?t.jsxs(t.Fragment,{children:[t.jsx(te,{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md",onClick:()=>{V(!1),ne(null)},children:"Cancel"}),t.jsx(te,{className:"px-4 py-2 bg-green-600 text-white rounded-md",onClick:()=>{typeof $e=="function"&&$e(),V(!1),ne(null)},children:"Confirm"})]}):t.jsx(te,{className:"px-4 py-2 bg-blue-600 text-white rounded-md",onClick:()=>V(!1),children:"Close"})})]})}),t.jsx(Pe,{open:ut,onOpenChange:ue,children:t.jsxs(Te,{children:[t.jsxs(Le,{children:[t.jsx(Fe,{children:"Some Items Skipped"}),t.jsx(ke,{children:"This supplier already quoted for some items, so they were skipped:"})]}),t.jsx(De,{className:"mt-4",children:t.jsx(te,{onClick:()=>ue(!1),children:"OK"})})]})})]})}export{Lr as default};
