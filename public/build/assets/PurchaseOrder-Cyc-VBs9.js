import{v as y,r as b,j as e,$ as j}from"./app-93n4-YE1.js";import{S as v}from"./SupplyOfficerLayout-CIJBK7rX.js";import"./toaster-CR_CLjT4.js";import"./index-BYPC565r.js";import"./index-DEGu_kMU.js";import"./index-C6Troi14.js";import"./Dropdown--SqrWfdR.js";import"./transition-B8_0YiEE.js";import"./XMarkIcon-BajPl_Ya.js";import"./clipboard-check-BUpBKaMS.js";function A({purchaseRequests:n,filters:o}){const{data:i,setData:d,get:c}=y({search:o.search||"",division:o.division||""});return b.useEffect(()=>{const s=setTimeout(()=>{c(route("supply_officer.purchase_orders"),{preserveState:!0,replace:!0})},300);return()=>clearTimeout(s)},[i.search,i.division]),e.jsxs(v,{header:"Schools Division Office - Ilagan | Create Purchase Order",children:[e.jsx(j,{title:"Purchase Order"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-8 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:"Purchase Requests with Selected Suppliers"}),e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"flex flex-wrap items-center gap-3",children:[e.jsx("input",{type:"text",name:"search",placeholder:"Search PR number or focal person",className:"w-96 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:i.search,onChange:s=>d("search",s.target.value)}),e.jsxs("select",{value:i.division,onChange:s=>d("division",s.target.value),className:"border border-gray-300 px-10 py-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Divisions"}),o.divisions.map(s=>e.jsx("option",{value:s.id,children:s.division},s.id))]})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg shadow-sm bg-white",children:e.jsxs("table",{className:"w-full table-auto text-sm divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["PR Number","Focal Person","Division","Item","Specs","Quantity","Unit","Winner Supplier","Quoted Price","Actions"].map(s=>e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wide text-center whitespace-nowrap",children:s},s))})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-center",children:n.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"py-12 text-gray-500 text-lg font-medium",children:"No Purchase Requests with winners found."})}):n.data.map(s=>{var m,x,u,h,g;const t=s.details.filter(a=>{var r;return(r=s.rfqs)==null?void 0:r.flatMap(l=>l.details).some(l=>l.pr_details_id===a.id&&l.is_winner)});if(t.length===0)return null;const p=(m=s.rfqs)==null?void 0:m.flatMap(a=>a.details??[]).filter(a=>t.some(r=>r.id===a.pr_details_id)&&a.is_winner),f=p.reduce((a,r)=>a+parseFloat(r.quoted_price||0),0);return e.jsxs("tr",{className:"hover:bg-blue-50 transition duration-200",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-blue-700 whitespace-nowrap",children:s.pr_number}),e.jsxs("td",{className:"px-6 py-4",children:[s.focal_person.firstname," ",s.focal_person.lastname]}),e.jsx("td",{className:"px-6 py-4",children:s.division.division}),e.jsxs("td",{className:"px-6 py-4",children:[((x=t[0])==null?void 0:x.product.name)||"—",t.length>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",t.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((u=t[0])==null?void 0:u.product.specs)||"—",t.length>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",t.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((h=t[0])==null?void 0:h.quantity)||"—",new Set(t.map(a=>a.quantity)).size>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",t.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((g=t[0])==null?void 0:g.product.unit.unit)||"—",new Set(t.map(a=>a.product.unit.unit)).size>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",t.length-1," more"]})]}),e.jsx("td",{className:"px-6 py-4",children:[...new Set(p.map(a=>{var r;return((r=a.supplier)==null?void 0:r.company_name)||"N/A"}))].join(", ")}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",f.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 align-middle",children:e.jsx("a",{href:route("supply_officer.create_po",s.id),className:`inline-block px-4 py-2 text-sm font-medium rounded-md transition ${s.has_po?"bg-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,onClick:a=>s.has_po&&a.preventDefault(),children:s.has_po?"PO Generated":"Purchase Order"})})]},`pr-${s.id}`)})})]})}),e.jsx("div",{className:"mt-6 flex justify-center flex-wrap gap-1",children:n.links.map((s,t)=>e.jsx("button",{disabled:!s.url,onClick:()=>s.url&&c(s.url),className:`px-3 py-1 text-sm border rounded-md ${s.active?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,dangerouslySetInnerHTML:{__html:s.label}},t))})]})}export{A as default};
